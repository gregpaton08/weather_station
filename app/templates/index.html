<!DOCTYPE html>
<html>
<head>
    <title>Weather</title>
    <link href="/static/css/index.css" rel="stylesheet">
</head>
<body>
    <script type=text/javascript src="{{ url_for('static', filename='jquery.js') }}"></script>
    <script type=text/javascript>
        var displayTemperatureInFahrenheit = true;
        var insideTemperatureC = 0;
        var outsideTemperatureC = 0;
        var forecastData = [];

        function convertCelsiusToFahrenheit(celsius) {
            return Math.round(((celsius * 9.0) / 5.0) + 32.0);
        }

        function convertTemperature(temperature) {
            if (displayTemperatureInFahrenheit) {
                return convertCelsiusToFahrenheit(temperature);
            } else {
                return temperature;
            }
        }

        function formatTime(hour) {
            if (hour == 0) {
                return '12 am';
            } else if (hour > 12) {
                return String(hour - 12) + ' pm';
            } else if (hour == 12) {
                return '12 pm';
            } else {
                return String(hour) + ' am';
            }
        }

        function updateTemperature() {
            $('#insidetemp').text(convertTemperature(insideTemperatureC));
            $('#outsidetemp').text(convertTemperature(outsideTemperatureC));
        }

        function updateForecast() {
            $html = '';
            $.each(forecastData, function(index, value) {
                $html += '<td><div class="time">' + formatTime(value.hour) + '</div><div class="temperature">' + String(convertTemperature(value.temperature)) + '&deg;</div></td>';

                return index < 12;
            });
            $('#hourly_forecast tr').html($html).show();
        }

        function updateData() {
            $SCRIPT_ROOT = ''

            var temperatureUrls = {};
            temperatureUrls['#insidetemp'] = '/get_inside_temperature_c';
            temperatureUrls['#outsidetemp'] = '/get_outside_temperature_c';

            $.getJSON($SCRIPT_ROOT + '/get_temperature_data_c', {}, function(data) {
                insideTemperatureC = data.inside_temperature;
                outsideTemperatureC = data.outside_temperature;

                updateTemperature();
            });

            $.getJSON($SCRIPT_ROOT + '/get_hourly_forecast', {}, function(data) {
                $.each(data.forecast, function(index, value) {
                    data = {}
                    data['hour'] = value.FCTTIME.hour;
                    data['temperature'] = value.temp.metric;
                    forecastData.push(data);
                });

                updateForecast();
            });
        }

        updateData();

        $(function() {
            setInterval(updateData, 30000);
        });

        $(function() {    
            $("#temp_type").click(function(e) {
                e.preventDefault();
                displayTemperatureInFahrenheit = !displayTemperatureInFahrenheit;
                if (displayTemperatureInFahrenheit) {
                    $("#temp_type").html('<a href="#">c&deg;</a>|f&deg;');
                } else {
                    $("#temp_type").html('c&deg;|<a href="#">f&deg;</a>');
                }
                updateTemperature();
                updateForecast();
            });
        });

    </script>
    <div id="temp_type"><a href="#">c&deg;</a>|f&deg;</div>
    <div class="center">
        <span class="intemp">
            <!-- <img src="static/home.png" height="50" width="50"> -->
            <span id="insidetemp"></span>&deg;
        </span>
        <span class="outtemp">
            <span id="outsidetemp"></span>&deg;
<!--             {% if condition == "overcast" %}
            <img src="/static/overcast.png" height="64" width="64">
            {% elif condition == "fog" %}
            <img src="/static/fog.png" height="64" width="64">
            {% elif condition == "clear" %}
            <img src="/static/moon.png" height="64" width="64">
            {% else %}
            and {{ condition }}
            {% endif %} -->
        </span>
        <br/>
    </div>
    <div id="hourly_forecast">
        <table>
            <tr>
            {% for hour in hourly %}
                <td>
                    <div class="time">
                        {% if hour.FCTTIME.hour|int == 0 %}
                            12 am
                        {% elif hour.FCTTIME.hour|int > 12 %}
                            {{ hour.FCTTIME.hour|int - 12 }} pm
                        {% elif hour.FCTTIME.hour|int == 12 %}
                            {{ hour.FCTTIME.hour|int }} pm
                        {% else %}
                            {{ hour.FCTTIME.hour }} am
                        {% endif %}
                    </div>
                    <div class="temperature">
                        {{ hour.temp.english }}&deg;
                    </div>
<!--                     <div class="condition">
                        {{ hour.condition }}
                    </div> -->
                </td>
            {% endfor %}
            </tr>
    </table>
    </div>
</body>
</html>